<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="host">

  <!-- 공통 컬럼 매핑: 존재 확실한 컬럼만 -->
  <sql id="space_cols">
    s.spacesNo       AS spacesno,
    s.userNo         AS userno,
    s.spaceName      AS spacename,
    s.spaceSummary   AS spacesummary,
    s.spaceInfo      AS spaceinfo,
    s.email          AS email,
    s.phone          AS phone,
    s.tel            AS tel,
    s.spaceLink      AS spacelink,
    s.postCode       AS postcode,
    s.address        AS address,
    s.addressDetail  AS addressdetail
  </sql>

  <!-- 로그인 유저의 최신 1건 -->
  <select id="select_host_by_userno" parameterType="map" resultType="com.javaex.vo.HostVO">
    SELECT
      <include refid="space_cols"/>
    FROM spaces s
    WHERE s.userNo = #{userno}
    ORDER BY s.spacesNo DESC
    LIMIT 1
  </select>

  <!-- 내 공간 리스트 -->
  <select id="select_spaces_by_userno" parameterType="map" resultType="com.javaex.vo.HostVO">
    SELECT
      <include refid="space_cols"/>
    FROM spaces s
    WHERE s.userNo = #{userno}
    ORDER BY s.spacesNo DESC
  </select>

  <!-- 신규 등록: 최소 컬럼만 INSERT -->
  <insert id="insert_space"
          parameterType="com.javaex.vo.HostVO"
          useGeneratedKeys="true"
          keyProperty="spacesno"
          keyColumn="spacesNo">
    INSERT INTO spaces (
      userNo, spaceName, spaceSummary, spaceInfo,
      email, phone, tel,
      spaceLink, postCode,
      address, addressDetail
    ) VALUES (
      #{userno}, #{spacename}, #{spacesummary}, #{spaceinfo},
      #{email}, #{phone}, #{tel},
      #{spacelink}, #{postcode},
      #{address}, #{addressdetail}
    )
  </insert>

  <!-- 수정: 최소 컬럼만 UPDATE -->
  <update id="update_space" parameterType="com.javaex.vo.HostVO">
    UPDATE spaces
    SET spaceName      = #{spacename},
        spaceSummary   = #{spacesummary},
        spaceInfo      = #{spaceinfo},
        email          = #{email},
        phone          = #{phone},
        tel            = #{tel},
        spaceLink      = #{spacelink},
        postCode       = #{postcode},
        address        = #{address},
        addressDetail  = #{addressdetail}
    WHERE spacesNo = #{spacesno}
      AND userNo   = #{userno}
  </update>

</mapper>
