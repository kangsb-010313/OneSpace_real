<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="host">

  <!-- 공통 컬럼 -->
  <sql id="space_cols">
    spacesNo      as spacesno,
    userNo        as userno,
    spaceName     as spacename,
    spaceSummary  as spacesummary,
    spaceInfo     as spaceinfo,
    email         as email,
    phone         as phone,
    tel           as tel,
    spaceLink     as spacelink,
    postCode      as postcode,
    address       as address,
    addressDetail as addressdetail,
    repImg        as repimg,
    instDtm       as instdtm,
    updtDtm       as updtdtm
  </sql>

  <!-- 로그인 사용자 공간 목록 -->
  <select id="spaces_by_user" parameterType="long" resultType="com.javaex.vo.HostVO">
    select <include refid="space_cols"/>
      from spaces
     where userNo = #{value}
     order by instDtm desc, spacesNo desc
  </select>

  <!-- 단건 조회 -->
  <select id="space_by_no" parameterType="long" resultType="com.javaex.vo.HostVO">
    select <include refid="space_cols"/>
      from spaces
     where spacesNo = #{value}
     limit 1
  </select>

  <!-- 신규 생성 -->
  <insert id="insert_space" parameterType="com.javaex.vo.HostVO"
          useGeneratedKeys="true" keyProperty="spacesno" keyColumn="spacesNo">
    insert into spaces (
      userNo,
      spaceName,
      spaceSummary,
      spaceInfo,
      email,
      phone,
      tel,
      spaceLink,
      postCode,
      address,
      addressDetail,
      repImg,
      instDtm,
      updtDtm
    ) values (
      #{userno},
      #{spacename},
      #{spacesummary},
      #{spaceinfo},
      #{email},
      #{phone},
      #{tel},
      #{spacelink},
      #{postcode},
      #{address},
      #{addressdetail},
      #{repimg},
      now(), now()
    )
  </insert>

  <!-- 수정 (repImg는 값이 들어온 경우에만 교체) -->
  <update id="update_space" parameterType="com.javaex.vo.HostVO">
    update spaces
       set spaceName     = #{spacename}
         , spaceSummary  = #{spacesummary}
         , spaceInfo     = #{spaceinfo}
         , email         = #{email}
         , phone         = #{phone}
         , tel           = #{tel}
         , spaceLink     = #{spacelink}
         , postCode      = #{postcode}
         , address       = #{address}
         , addressDetail = #{addressdetail}
         <if test="repimg != null and repimg != ''">
         , repImg        = #{repimg}
         </if>
         , updtDtm       = now()
     where spacesNo = #{spacesno}
       and userNo   = #{userno}
  </update>

  <!-- 시설 관련: 아직 스키마 연동 안 하면 no-op 유지 -->
  <delete id="delete_facilities_by_spacesno" parameterType="long">
    delete from facilityInfo where 1 = 0
  </delete>

  <insert id="insert_facility">
    insert into facilityInfo (facilityName)
    select #{facilityName} from dual where 1 = 0
  </insert>

  <select id="select_facilities_by_spacesno" parameterType="long" resultType="string">
    select facilityName from facilityInfo where 1 = 0
  </select>

</mapper>
