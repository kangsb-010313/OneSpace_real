<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="room">

  <sql id="room_cols">
    r.roomNo   AS roomNo,
    r.spacesNo AS spacesNo,
    r.roomName AS roomName,
    r.roomInfo AS roomInfo,
    r.area     AS area,
    r.capacity AS capacity,
    r.instDtm  AS instDtm,
    r.updtDtm  AS updtDtm
  </sql>

  <!-- 특정 공간의 방 목록 -->
  <select id="select_rooms_by_spacesno" parameterType="long" resultType="com.javaex.vo.RoomsVO">
    SELECT <include refid="room_cols"/>
    FROM rooms r
    WHERE r.spacesNo = #{value}
    ORDER BY r.roomNo DESC
  </select>

  <!-- 방 상세 -->
  <select id="select_room_detail" parameterType="long" resultType="com.javaex.vo.RoomsVO">
    SELECT <include refid="room_cols"/>
    FROM rooms r
    WHERE r.roomNo = #{value}
    LIMIT 1
  </select>

  <!-- 방 신규 등록 -->
  <insert id="insert_room" parameterType="com.javaex.vo.RoomsVO"
          useGeneratedKeys="true" keyProperty="roomNo" keyColumn="roomNo">
    INSERT INTO rooms (
      spacesNo, roomName, roomInfo, area, capacity, instDtm, updtDtm
    ) VALUES (
      #{spacesNo}, #{roomName}, #{roomInfo}, #{area}, #{capacity}, NOW(), NOW()
    )
  </insert>

  <!-- 방 수정 -->
  <update id="update_room" parameterType="com.javaex.vo.RoomsVO">
    UPDATE rooms
       SET roomName = #{roomName},
           roomInfo = #{roomInfo},
           area     = #{area},
           capacity = #{capacity},
           updtDtm  = NOW()
     WHERE roomNo  = #{roomNo}
  </update>

  <!-- 방 삭제 -->
  <delete id="delete_room" parameterType="long">
    DELETE FROM rooms WHERE roomNo = #{value}
  </delete>

</mapper>
