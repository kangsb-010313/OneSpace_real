<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="teampage">

<!-- 쿼리문 작성 -->
	<!-- 팀페이지 리스트(팀선택시) -->
	<select id="selectListByTeamNo" parameterType="int" resultType="com.javaex.vo.TeamPostVO">
		<![CDATA[
			SELECT  p.teamPostNo,
                    p.teamNo,
                    p.userNo,
                    p.teamPostType,
                    p.teamPostTitle,
                    p.teamContent,
                    date_format(p.teamWriteDate, '%Y-%m-%d') as teamWriteDate,
                    date_format(p.teamUpdateDate, '%Y-%m-%d') as teamUpdateDate,
                    u.userName,   -- users 테이블에서 작성자 이름 가져오기
                    t.teamName    -- teams 테이블에서 팀 이름 가져오기
            from posts p
            join users u on p.userNo = u.userNo
            join teams t on p.teamNo = t.teamNo
            where p.teamNo = #{teamNo}
            order by p.teamWriteDate desc, p.teamPostNo desc
		]]>
	</select>
	
	
	<!-- TODO: aside 출력을 위한 모든 팀 목록 조회 쿼리 추가 -->
    <!-- <select id="selectAllTeams" resultType="com.javaex.vo.TeamVO">
        SELECT teamNo, teamName FROM teams ORDER BY teamName ASC
    </select> -->

    <!-- TODO: 특정 팀 정보를 가져오는 쿼리 추가 -->
    <!-- <select id="selectTeamInfo" parameterType="int" resultType="com.javaex.vo.TeamVO">
        SELECT teamNo, teamName, instaAccount, teamCreatedDate FROM teams WHERE teamNo = #{teamNo}
    </select> -->
    
    
    <!-- 게시글 상세 조회, 수정폼 -->
    <select id="selectPostByNo" parameterType="int" resultType="com.javaex.vo.TeamPostVO">
        <![CDATA[
            select  p.teamPostNo,
                    p.teamNo,
                    p.userNo,
                    p.teamPostType,
                    p.teamPostTitle,
                    p.teamContent,
                    date_format(p.teamWriteDate, '%Y-%m-%d') as teamWriteDate,
                    date_format(p.teamUpdateDate, '%Y-%m-%d') as teamUpdateDate,
                    u.userName,
                    t.teamName
            from posts p
            join users u ON p.userNo = u.userNo
            join teams t ON p.teamNo = t.teamNo
            where p.teamPostNo = #{teamPostNo}
        ]]>
    </select>
    

	<!-- 일반공지등록 글쓰기 -->
	<insert id="insert" parameterType="com.javaex.vo.TeamPostVO">
		<![CDATA[
			insert into posts(teamPostNo, teamNo, teamPostType, teamPostTitle, teamContent, teamWriteDate, userNo)
			values(null, #{teamNo}, #{teamPostType}, #{teamPostTitle}, #{teamContent}, now(), #{userNo})
		]]>
	</insert>
	
	
    <!-- 게시글 삭제 -->
    <delete id="delete" parameterType="int">
        <![CDATA[
            DELETE FROM posts
            WHERE teamPostNo = #{teamPostNo}
        ]]>
    </delete>

</mapper>