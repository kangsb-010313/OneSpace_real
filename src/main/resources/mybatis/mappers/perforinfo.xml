<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="perforinfo">

  <!-- VO 매핑: 자바시간타입/DB타입 명시 (핸들러 이슈 예방) -->
  <resultMap id="PerforInfoMap" type="com.javaex.vo.PerforInfoVO">
    <id     column="no"        property="no"/>
    <result column="category"  property="category"/>
    <result column="title"     property="title"/>
    <result column="url"       property="url"/>
    <result column="region"    property="region"/>
    <result column="content"   property="content"/>
    <result column="closedate" property="closedate"  javaType="java.time.LocalDate"      jdbcType="DATE"/>
    <result column="regdate"   property="regdate"    javaType="java.time.LocalDateTime"  jdbcType="TIMESTAMP"/>
    <result column="userno"    property="userno"/>
    <result column="username"  property="username"/>
  </resultMap>

  <!-- 목록 -->
  <select id="list" resultMap="PerforInfoMap">
    select
      no, category, title, url, region, content, closedate, regdate, userno, username
    from performance_info
    order by regdate desc, no desc
  </select>

  <!-- 단건 -->
  <select id="get" parameterType="long" resultMap="PerforInfoMap">
    select
      no, category, title, url, region, content, closedate, regdate, userno, username
    from performance_info
    where no = #{no}
  </select>

  <!-- 등록: AUTO_INCREMENT + useGeneratedKeys -->
  <insert id="insert"
          parameterType="com.javaex.vo.PerforInfoVO"
          useGeneratedKeys="true" keyProperty="no">
    insert into performance_info
      (category, title, url, region, content, closedate, regdate, userno, username)
    values
      (#{category},
       #{title},
       #{url},
       #{region},
       #{content},
       #{closedate,jdbcType=DATE},    <!-- null 안전 -->
       now(),                         <!-- DB에서 등록시각 -->
       #{userno},
       #{username})
  </insert>

</mapper>
