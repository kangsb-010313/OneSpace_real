<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.javaex.repository.PrideRepository">

  <!-- 목록 -->
  <select id="selectPrideCards" resultType="com.javaex.vo.PrideVO">
    SELECT
      p.teamPostNo      AS teamPostNo,
      p.teamNo          AS teamNo,
      p.teamPostTitle   AS teamPostTitle,
      p.teamContent     AS teamContent,
      t.teamName        AS teamName,
      COALESCE(t.instaAccount, '') AS instaAccount
    FROM posts p
    LEFT JOIN teams t ON t.teamNo = p.teamNo
    WHERE p.teamPostType = #{teamPostType}
    ORDER BY p.teamPostNo DESC
    LIMIT #{limit} OFFSET #{offset}
  </select>

  <!-- 총 개수 -->
  <select id="countPride" resultType="int">
    SELECT COUNT(*)
    FROM posts p
    WHERE p.teamPostType = #{teamPostType}
  </select>

  <!-- 상세 -->
  <select id="selectPrideDetail" resultType="com.javaex.vo.PrideVO">
    SELECT
      p.teamPostNo      AS teamPostNo,
      p.teamNo          AS teamNo,
      p.teamPostTitle   AS teamPostTitle,
      p.teamContent     AS teamContent,
      p.teamWriteDate   AS teamWriteDate,
      p.teamUpdateDate  AS teamUpdateDate,
      t.teamName        AS teamName,
      t.instaAccount    AS instaAccount
    FROM posts p
    LEFT JOIN teams t ON t.teamNo = p.teamNo
    WHERE p.teamPostType = #{teamPostType}
      AND p.teamPostNo = #{id}
    LIMIT 1
  </select>
 <!-- PrideRepository.xml -->
<select id="selectPrideImages" resultType="string">
  SELECT CONCAT('/upload/', teamFilePath, '/', teamStoredFileName) AS url
  FROM teamAttachments
  WHERE postNo = #{id}
  ORDER BY teamFileNo ASC
</select>

</mapper>
