<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.javaex.repository.PrideRepository">

  <!-- 팀자랑 목록 (posts + teams 조인) -->
  <select id="selectPridePage" resultType="com.javaex.vo.PrideVO">
    SELECT
      p.teamPostNo     AS teamPostNo,
      p.teamNo         AS teamNo,
      p.teamPostType   AS teamPostType,
      p.teamPostTitle  AS teamPostTitle,
      p.teamContent    AS teamContent,
      p.teamWriteDate  AS teamWriteDate,
      p.teamUpdateDate AS teamUpdateDate,
      t.teamName       AS teamName,
      t.instaAccount   AS instaAccount
    FROM posts p
    LEFT JOIN teams t ON t.teamNo = p.teamNo
    WHERE p.teamPostType = 'TEAM_PRIDE'
    ORDER BY p.teamPostNo DESC
    LIMIT #{size} OFFSET #{offset}
  </select>

  <!-- 팀자랑 총 개수 -->
  <select id="countPride" resultType="long">
    SELECT COUNT(*)
    FROM posts
    WHERE teamPostType = 'TEAM_PRIDE'
  </select>

  <!-- 팀자랑 상세 조회 -->
  <select id="selectPrideOne" resultType="com.javaex.vo.PrideVO">
    SELECT
      p.teamPostNo     AS teamPostNo,
      p.teamNo         AS teamNo,
      p.teamPostType   AS teamPostType,
      p.teamPostTitle  AS teamPostTitle,
      p.teamContent    AS teamContent,
      p.teamWriteDate  AS teamWriteDate,
      p.teamUpdateDate AS teamUpdateDate,
      t.teamName       AS teamName,
      t.instaAccount   AS instaAccount
    FROM posts p
    LEFT JOIN teams t ON t.teamNo = p.teamNo
    WHERE p.teamPostNo = #{teamPostNo}
      AND p.teamPostType = 'TEAM_PRIDE'
  </select>

  <!-- 팀자랑 등록 -->
  <insert id="insertPride" parameterType="com.javaex.vo.PrideVO"
          useGeneratedKeys="true" keyProperty="teamPostNo">
    INSERT INTO posts (teamNo, teamPostType, teamPostTitle, teamContent, teamWriteDate)
    VALUES (#{teamNo}, 'TEAM_PRIDE', #{teamPostTitle}, #{teamContent}, NOW())
  </insert>

</mapper>
